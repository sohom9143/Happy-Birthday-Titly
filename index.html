<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Most Beautiful Birthday Cake Ever!</title>
    <link rel="preload" href="https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMwLtVKi7zlMQ.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="https://fonts.gstatic.com/s/pacifico/v22/FwZY7Us-P8zMJzJb-Jt9k7fdwGhrC8o.woff2" as="font" type="font/woff2" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
    <style>
        /* General Body Styling */
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to bottom right, #fdf0f2, #e6e6fa);
            margin: 0;
            overflow: hidden; /* Prevent scrollbars due to animations */
            font-family: 'Inter', sans-serif;
            color: #333;
            position: relative;
        }

        /* Background Bubbles (Cute Element) - Efficient animation with CSS variables */
        .background-bubbles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allow interaction with elements below */
            overflow: hidden;
            z-index: 1;
        }

        .bubble {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: floatUp var(--anim-duration) infinite ease-in-out var(--anim-delay);
            opacity: 0;
            /* Using transform for animation (GPU accelerated) */
            transform: translateY(100vh) translateX(0);
            will-change: transform, opacity; /* Hint to browser for optimization */
        }

        @keyframes floatUp {
            0% { transform: translateY(100vh) translateX(0); opacity: 0; }
            20% { opacity: 0.7; }
            100% { transform: translateY(-100vh) translateX(var(--float-x, 0)); opacity: 0; }
        }

        /* Happy Birthday Message (Above Cake) */
        .message {
            font-family: 'Pacifico', cursive;
            font-size: 3.5em;
            font-weight: bold;
            color: #da70d6;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.25);
            opacity: 0;
            transform: translateY(-80px) scale(0.8);
            transition: opacity 1.2s ease-out, transform 1.2s ease-out;
            z-index: 20;
            text-align: center;
            width: 100%;
            margin-bottom: 30px;
            will-change: opacity, transform;
        }

        .message.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* Cake Container - for perspective */
        .cake-container {
            perspective: 1200px;
            perspective-origin: center center;
            position: relative;
            z-index: 10;
        }

        /* Cake Base (Plate/Stand) */
        .cake-base {
            position: absolute;
            width: 280px;
            height: 30px;
            background: linear-gradient(to bottom, #dcdcdc, #b0b0b0);
            border-radius: 50% / 10%;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%) rotateX(70deg);
            box-shadow: 0 12px 25px rgba(0,0,0,0.3), 0 0 20px rgba(255,255,255,0.6) inset;
            z-index: 0;
        }

        /* Main Cake Structure */
        .cake {
            position: relative;
            width: 250px;
            height: 200px;
            transform-style: preserve-3d;
            transform: rotateX(70deg) translateY(0);
            transform-origin: bottom center;
        }

        /* Individual Cake Layers */
        .layer {
            position: absolute;
            width: 100%;
            height: 60px;
            border-radius: 50% / 10%;
            box-shadow: 0 5px 0 rgba(0,0,0,0.1) inset, 0 0 10px rgba(0,0,0,0.05);
            transform: translateY(-300px) rotateX(70deg);
            transform-origin: bottom center;
            opacity: 0;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.6s ease-in;
            will-change: transform, opacity;
        }

        .layer.animate {
            transform: translateY(0) rotateX(70deg);
            opacity: 1;
        }

        /* Layer Specific Styling (optimized properties) */
        .layer-1 { background-color: #ffb6c1; top: 140px; z-index: 3; box-shadow: 0 6px 0 rgba(0,0,0,0.15) inset, 0 0 12px rgba(0,0,0,0.08); }
        .layer-2 { background-color: #ffc0cb; top: 70px; z-index: 2; box-shadow: 0 6px 0 rgba(0,0,0,0.15) inset, 0 0 12px rgba(0,0,0,0.08); }
        .layer-3 { background-color: #ffe4e1; top: 0px; z-index: 1; box-shadow: 0 6px 0 rgba(0,0,0,0.15) inset, 0 0 12px rgba(0,0,0,0.08); }

        /* Frosting on top */
        .frosting {
            position: absolute;
            width: 100%;
            height: 28px;
            background-color: #ffffff;
            border-radius: 50% / 10%;
            top: -18px;
            z-index: 4;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1) inset, 0 0 20px rgba(255,255,255,0.9);
            transform: rotateX(70deg);
            transform-origin: bottom center;
            opacity: 0;
            transition: opacity 0.6s ease-in 0.6s;
            will-change: opacity;
        }

        .frosting.animate {
            opacity: 1;
        }

        /* Candles Container */
        .candles {
            position: absolute;
            width: 80%;
            top: -65px;
            left: 10%;
            display: flex;
            justify-content: space-around;
            z-index: 5;
            transform: rotateX(70deg);
            transform-origin: bottom center;
            opacity: 0;
            transition: opacity 0.9s ease-in 1.1s;
            will-change: opacity;
        }

        .candles.animate {
            opacity: 1;
        }

        /* Individual Candle */
        .candle {
            width: 14px;
            height: 45px;
            background: linear-gradient(to top, #fffacd, #ffefd5);
            border-radius: 5px;
            position: relative;
            box-shadow: 0 0 10px rgba(255,215,0,0.7);
            transform: scaleY(0);
            transform-origin: bottom;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            will-change: transform;
        }

        .candle.animate {
            transform: scaleY(1);
        }

        /* Candle Flame */
        .flame {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 25px;
            background: radial-gradient(circle at 50% 0%, #fff 0%, #ffeb3b 30%, #ffc107 70%, transparent 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            box-shadow: 0 0 20px 8px rgba(255,255,0,0.9), 0 0 35px 12px rgba(255,165,0,0.7);
            animation: flicker 0.2s infinite alternate ease-in-out;
            opacity: 0;
            transition: opacity 0.4s ease-in 0.3s;
            will-change: opacity, transform, box-shadow;
        }

        .flame.animate {
            opacity: 1;
        }

        /* Flame Flickering Animation */
        @keyframes flicker {
            0% { transform: translateX(-50%) scaleY(1) scaleX(1); opacity: 1; box-shadow: 0 0 20px 8px rgba(255,255,0,0.9), 0 0 35px 12px rgba(255,165,0,0.7); }
            33% { transform: translateX(-50%) scaleY(0.97) scaleX(1.03); opacity: 0.95; box-shadow: 0 0 18px 7px rgba(255,255,0,0.8), 0 0 30px 10px rgba(255,165,0,0.6); }
            66% { transform: translateX(-50%) scaleY(1.02) scaleX(0.98); opacity: 1; box-shadow: 0 0 22px 9px rgba(255,255,0,1), 0 0 40px 14px rgba(255,165,0,0.8); }
            100% { transform: translateX(-50%) scaleY(1) scaleX(1); opacity: 1; box-shadow: 0 0 20px 8px rgba(255,255,0,0.9), 0 0 35px 12px rgba(255,165,0,0.7); }
        }

        /* Sprinkles Container */
        .sprinkle-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 25;
        }

        /* Individual Sprinkle */
        .sprinkle {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            opacity: 0;
            animation: fallAndFade 2s forwards ease-in;
            will-change: transform, opacity;
        }

        /* Animation for sprinkles falling and fading */
        @keyframes fallAndFade {
            0% { transform: translateY(-50px) rotate(0deg); opacity: 0; }
            20% { opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        /* Envelope Container */
        .envelope-container {
            margin-top: 50px;
            position: relative;
            width: 300px;
            height: 200px;
            opacity: 0;
            transform: translateY(50px) scale(0.8);
            transition: opacity 1s ease-out, transform 1s ease-out;
            z-index: 30;
            cursor: pointer;
            will-change: opacity, transform;
        }

        .envelope-container.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .envelope {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: #fce4ec; /* Light pink envelope */
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Envelope Flap */
        .envelope-flap {
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid transparent; /* Half width */
            border-right: 150px solid transparent; /* Half width */
            border-bottom: 100px solid #efc9d4; /* Half height */
            transform-origin: top;
            transition: transform 0.6s ease-in-out;
            z-index: 2;
            will-change: transform;
        }

        .envelope.open .envelope-flap {
            transform: rotateX(180deg);
        }

        /* Envelope Back */
        .envelope-back {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 0;
            border-left: 150px solid #f9d8e0; /* Half width */
            border-right: 150px solid #f9d8e0; /* Half width */
            border-top: 100px solid transparent; /* Half height */
            border-bottom: 100px solid #f9d8e0; /* Half height */
            border-radius: 0 0 10px 10px;
            z-index: 1;
        }

        /* Greeting Card inside Envelope - Made more adjustable and bigger */
        .greeting-card {
            position: absolute;
            top: 50%;
            left: 50%;
            /* Using flexible widths/heights relative to parent envelope, with max-sizes */
            width: 90%;
            height: 95%;
            max-width: 500px; /* Limits the max size of the card itself */
            max-height: 400px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            transform: translate(-50%, -50%) translateY(200px);
            opacity: 0;
            transition: transform 0.8s ease-out, opacity 0.8s ease-out;
            padding: 25px;
            text-align: center;
            box-sizing: border-box;
            font-size: 1.6em; /* **Bigger default font size for the card text** */
            line-height: 1.6;
            color: #6a5acd;
            z-index: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow: auto; /* Allows scrolling if content exceeds max-height */
            will-change: transform, opacity;
        }

        .envelope.open .greeting-card {
            transform: translate(-50%, -50%) translateY(0);
            opacity: 1;
            z-index: 3;
        }

        .greeting-card p {
            opacity: 0;
            transition: opacity 1s ease-in-out;
            margin: 0.6em 0;
            will-change: opacity;
        }

        .greeting-card p.show {
            opacity: 1;
        }

        /* Responsive adjustments (optimized) */
        @media (max-width: 768px) {
            .message { font-size: 2.5em; margin-bottom: 25px; }
            .cake { width: 200px; height: 160px; }
            .layer { height: 50px; }
            .layer-1 { top: 110px; }
            .layer-2 { top: 55px; }
            .layer-3 { top: 0px; }
            .frosting { height: 22px; top: -12px; }
            .candle { width: 12px; height: 35px; }
            .flame { width: 15px; height: 20px; }
            .cake-base { width: 240px; height: 28px; }
            .envelope-container { width: 250px; height: 160px; }
            .envelope-flap, .envelope-back { border-left-width: 125px; border-right-width: 125px; border-bottom-width: 80px; border-top-width: 80px; }
            /* Adjust greeting card size for tablets */
            .greeting-card { font-size: 1.3em; padding: 20px; width: 95%; height: 95%; }
        }

        @media (max-width: 480px) {
            .message { font-size: 1.8em; margin-bottom: 20px; }
            .cake { width: 160px; height: 120px; }
            .layer { height: 40px; }
            .layer-1 { top: 90px; }
            .layer-2 { top: 45px; }
            .layer-3 { top: 0px; }
            .frosting { height: 18px; top: -10px; }
            .candle { width: 10px; height: 28px; }
            .flame { width: 12px; height: 16px; }
            .cake-base { width: 190px; height: 22px; }
            .envelope-container { width: 200px; height: 130px; }
            .envelope-flap, .envelope-back { border-left-width: 100px; border-right-width: 100px; border-bottom-width: 65px; border-top-width: 65px; }
            /* Adjust greeting card size for mobile */
            .greeting-card { font-size: 1.1em; padding: 15px; width: 95%; height: 95%; }
        }
    </style>
</head>
<body>
    <div class="background-bubbles" id="backgroundBubbles"></div>
    <div class="sprinkle-container" id="sprinkleContainer"></div>

    <div class="message" id="birthdayMessage">Happy Birthday! Titly</div>

    <div class="cake-container">
        <div class="cake-base"></div>
        <div class="cake">
            <div class="layer layer-1"></div>
            <div class="layer layer-2"></div>
            <div class="layer layer-3"></div>
            <div class="frosting"></div>
            <div class="candles">
                <div class="candle">
                    <div class="flame"></div>
                </div>
                <div class="candle">
                    <div class="flame"></div>
                </div>
                <div class="candle">
                    <div class="flame"></div>
                </div>
                <div class="candle">
                    <div class="flame"></div>
                </div>
                <div class="candle">
                    <div class="flame"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="envelope-container" id="envelopeContainer">
        <div class="envelope">
            <div class="envelope-flap"></div>
            <div class="envelope-back"></div>
            <div class="greeting-card" id="greetingCard">
                </div>
        </div>
    </div>

    <audio id="birthdayMusic" loop preload="auto" muted>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Cache DOM elements
            const layers = document.querySelectorAll('.cake .layer');
            const frosting = document.querySelector('.frosting');
            const candlesContainer = document.querySelector('.candles');
            const candles = document.querySelectorAll('.candle');
            const flames = document.querySelectorAll('.flame');
            const birthdayMessage = document.getElementById('birthdayMessage');
            const sprinkleContainer = document.getElementById('sprinkleContainer');
            const backgroundBubblesContainer = document.getElementById('backgroundBubbles');
            const envelopeContainer = document.getElementById('envelopeContainer');
            const envelope = document.querySelector('.envelope');
            const greetingCard = document.getElementById('greetingCard');
            const birthdayMusic = document.getElementById('birthdayMusic'); // Get the audio element

            const sprinkleColors = ['#ffb6c1', '#add8e6', '#ffee99', '#cc99ff', '#ffd700'];

            const titlyMessages = [
                "Happy Birthday Titly! ðŸŽ‚",
                " tor jonno ei special gift ðŸ’–",
                "I know, ami tor pase nei celebrate korar jonno",
                "kintu expect korchi tor ei gift ta bhalo lagbe ðŸŽ",
                "Many loves from me Enjoy your Day!,"
            ];

            let musicPlayed = false; // Flag to ensure music isn't attempted multiple times

            // Function to attempt playing music
            const tryPlayMusic = async () => {
                if (musicPlayed) return; // Don't try to play if already playing or attempted

                try {
                    // Try to play the music. This might fail due to autoplay policies.
                    await birthdayMusic.play();
                    birthdayMusic.muted = false; // Unmute if successful
                    musicPlayed = true;
                    console.log("Music started playing successfully.");
                } catch (error) {
                    console.warn("Music autoplay blocked:", error);
                    // If autoplay is blocked, wait for user interaction
                    if (error.name === "NotAllowedError" && !musicPlayed) {
                        console.log("Waiting for user interaction to play music...");
                        // Attach a one-time listener to the document for a click/tap
                        document.addEventListener('click', userInteractToPlayMusic, { once: true });
                        document.addEventListener('touchend', userInteractToPlayMusic, { once: true });
                    }
                }
            };

            // Callback function for user interaction to play music
            const userInteractToPlayMusic = () => {
                if (musicPlayed) return;
                console.log("User interacted. Attempting to play music...");
                tryPlayMusic(); // Try playing again after interaction
            };

            // --- Animation Functions ---

            const animateLayers = async () => {
                for (let i = 0; i < layers.length; i++) {
                    layers[i].classList.add('animate');
                    await new Promise(resolve => setTimeout(resolve, 600));
                }
                // Once cake layers are falling into place, attempt to play music
                // This is the "when the cake is appeared" moment.
                tryPlayMusic();
            };

            const animateToppers = async () => {
                frosting.classList.add('animate');
                await new Promise(resolve => setTimeout(resolve, 500));

                candlesContainer.classList.add('animate');
                for (let i = 0; i < candles.length; i++) {
                    candles[i].classList.add('animate');
                    await new Promise(resolve => setTimeout(resolve, 100));
                }

                for (let i = 0; i < flames.length; i++) {
                    flames[i].classList.add('animate');
                    await new Promise(resolve => setTimeout(resolve, 50));
                }

                birthdayMessage.classList.add('show');
                await new Promise(resolve => setTimeout(resolve, 1000));
            };

            const dropSprinkles = () => {
                const numberOfSprinkles = 80;
                for (let i = 0; i < numberOfSprinkles; i++) {
                    const sprinkle = document.createElement('div');
                    sprinkle.classList.add('sprinkle');
                    sprinkle.style.left = `${Math.random() * 100}vw`;
                    sprinkle.style.animationDelay = `${Math.random() * 1.5}s`;
                    sprinkle.style.backgroundColor = sprinkleColors[Math.floor(Math.random() * sprinkleColors.length)];
                    sprinkleContainer.appendChild(sprinkle);

                    sprinkle.addEventListener('animationend', () => sprinkle.remove(), { once: true });
                }
            };

            const createBackgroundBubbles = () => {
                const numberOfBubbles = 20;
                for (let i = 0; i < numberOfBubbles; i++) {
                    createSingleBubble();
                }
            };

            const createSingleBubble = () => {
                const bubble = document.createElement('div');
                bubble.classList.add('bubble');
                const size = Math.random() * 30 + 10;
                bubble.style.width = `${size}px`;
                bubble.style.height = `${size}px`;
                bubble.style.left = `${Math.random() * 100}vw`;
                bubble.style.setProperty('--anim-delay', `${Math.random() * 10}s`);
                bubble.style.setProperty('--anim-duration', `${Math.random() * 10 + 10}s`);
                bubble.style.setProperty('--float-x', `${(Math.random() - 0.5) * 200}px`);
                backgroundBubblesContainer.appendChild(bubble);

                bubble.addEventListener('animationend', () => {
                    bubble.remove();
                    requestAnimationFrame(createSingleBubble);
                }, { once: true });
            };

            const showEnvelope = async () => {
                await new Promise(resolve => setTimeout(resolve, 1000));
                envelopeContainer.classList.add('show');
            };

            const openEnvelope = async () => {
                envelope.classList.add('open');
                await new Promise(resolve => setTimeout(resolve, 800));

                for (let i = 0; i < titlyMessages.length; i++) {
                    const p = document.createElement('p');
                    p.textContent = titlyMessages[i];
                    greetingCard.appendChild(p);
                    void p.offsetWidth;
                    p.classList.add('show');
                    await new Promise(resolve => setTimeout(resolve, 2500));
                }
            };

            // --- Full Animation Sequence ---

            const startFullAnimation = async () => {
                createBackgroundBubbles();
                await animateLayers(); // Music play attempt is now inside animateLayers
                await animateToppers();
                dropSprinkles();
                await showEnvelope();
                
                // The envelope click will also count as a user interaction, potentially triggering music
                envelopeContainer.addEventListener('click', openEnvelope, { once: true });
            };

            startFullAnimation();
        });
    </script>
</body>
</html>
